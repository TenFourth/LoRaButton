100 WAN_JOIN
110 IF WAN_JOINSTAT <> 1 THEN
120   GOSUB _BLINK_LED
130   DEEP 0
140 ENDIF
150 DO
160   B=0:C=0:L=0
170   FOR N=0 TO 500 STEP 1
180     I=INP(6)
190     IF I=1 THEN
200       GOSUB _LED_ON
210       L=L+1
220       IF B=0 THEN
230         C=C+1
240       ENDIF
250     ELSE
260       GOSUB _LED_OFF
270     ENDIF
280     B=I
290     DELAY 10
300   NEXT
310   GOSUB _LED_OFF:DELAY 250
320   IF C=1 && L>300 THEN
330     C=C*10+C
340     GOSUB _LONG_FEEDBACK
350   ELSE
360     GOSUB _BLINK_FEEDBACK
370   ENDIF
380   GOSUB _SEND
390   SLEEP 0
400 LOOP
410 '
1000 _SEND
1010   V=ADC(27)
1020   TXD(8)=C
1030   TXD(9)=V>>8:TXD(10)=V&255
1040   TXD(7)=3 'length
1050   WAN_TX
1060   If STAT=0 Then
1070     GOSUB _LONG_FEEDBACK
1080   ELSE
1090     GOSUB _BLINK_LED
1100   ENDIF
1110   RETURN
1120 _LED_ON
1130   OUTP 18,1
1140   RETURN
1150 _LED_OFF
1160   OUTP 18,0
1170   RETURN
1180 _BLINK_LED
1190   FOR I=0 TO 10
1200     OUTP 18,1:DELAY 92:OUTP 18,0:DELAY 230
1210   NEXT
1220   RETURN
1230 _BLINK_FEEDBACK
1240   FOR M=1 TO C
1250     OUTP 18,1:DELAY 92:OUTP 18,0:DELAY 230
1260   NEXT
1270   RETURN
1280 _LONG_FEEDBACK
1290   OUTP 18,1:DELAY 3000:OUTP 18,0
1300   RETURN
